<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JetPackJoyRide: libcamera::ipa::FCQueue&lt; FrameContext &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JetPackJoyRide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibcamera.html">libcamera</a></li><li class="navelem"><a class="el" href="namespacelibcamera_1_1ipa.html">ipa</a></li><li class="navelem"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html">FCQueue</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlibcamera_1_1ipa_1_1FCQueue-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">libcamera::ipa::FCQueue&lt; FrameContext &gt; Class Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A support class for managing <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> instances in IPA modules.  
 <a href="classlibcamera_1_1ipa_1_1FCQueue.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a04b07447b9ff942b5bdb35f22110876f" id="r_a04b07447b9ff942b5bdb35f22110876f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a04b07447b9ff942b5bdb35f22110876f">FCQueue</a> (unsigned int size)</td></tr>
<tr class="memdesc:a04b07447b9ff942b5bdb35f22110876f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a frame contexts queue of a specified size.  <br /></td></tr>
<tr class="separator:a04b07447b9ff942b5bdb35f22110876f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a76eebb86d4d5b41fff9d4e950fb385" id="r_a7a76eebb86d4d5b41fff9d4e950fb385"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a7a76eebb86d4d5b41fff9d4e950fb385">clear</a> ()</td></tr>
<tr class="memdesc:a7a76eebb86d4d5b41fff9d4e950fb385"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear the contexts queue.  <br /></td></tr>
<tr class="separator:a7a76eebb86d4d5b41fff9d4e950fb385"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30a8f9b03de53964effa77b76aeef6e5" id="r_a30a8f9b03de53964effa77b76aeef6e5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a30a8f9b03de53964effa77b76aeef6e5">alloc</a> (const uint32_t frame)</td></tr>
<tr class="memdesc:a30a8f9b03de53964effa77b76aeef6e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and return a <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> for the <em>frame</em>.  <br /></td></tr>
<tr class="separator:a30a8f9b03de53964effa77b76aeef6e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a280f05d67bf0803ac96b777b41c11040" id="r_a280f05d67bf0803ac96b777b41c11040"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a280f05d67bf0803ac96b777b41c11040">get</a> (uint32_t frame)</td></tr>
<tr class="memdesc:a280f05d67bf0803ac96b777b41c11040"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtain the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> for the <em>frame</em>.  <br /></td></tr>
<tr class="separator:a280f05d67bf0803ac96b777b41c11040"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a>&gt;<br />
class libcamera::ipa::FCQueue&lt; FrameContext &gt;</div><p>A support class for managing <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> instances in IPA modules. </p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname"><a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a></td><td>The IPA module-specific <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> derived class type</td></tr>
  </table>
  </dd>
</dl>
<p>Along with the <a class="el" href="classlibcamera_1_1ipa_1_1Module.html" title="The base class for all IPA modules.">Module</a> and <a class="el" href="classlibcamera_1_1ipa_1_1Algorithm.html" title="The base class for all IPA algorithms.">Algorithm</a> classes, the frame context queue is a core component of the libipa infrastructure. It stores per-frame contexts used by the <a class="el" href="classlibcamera_1_1ipa_1_1Algorithm.html" title="The base class for all IPA algorithms.">Algorithm</a> operations. By centralizing the lifetime management of the contexts and implementing safeguards against underflows and overflows, it simplifies IPA modules and improves their reliability.</p>
<p>The queue references frame contexts by a monotonically increasing sequence number. The <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html" title="A support class for managing FrameContext instances in IPA modules.">FCQueue</a> design assumes that this number matches both the sequence number of the corresponding frame, as generated by the camera sensor, and the sequence number of the request. This allows IPA modules to obtain the frame context from any location where a request or a frame is available.</p>
<p>A frame context normally begins its lifetime when the corresponding request is queued, way before the frame is captured by the camera sensor. IPA modules allocate the context from the queue at that point, calling <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a30a8f9b03de53964effa77b76aeef6e5" title="Allocate and return a FrameContext for the frame.">alloc()</a> using the request number. The queue initializes the context, and the IPA module then populates it with data from the request. The context can be later retrieved with a call to <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a280f05d67bf0803ac96b777b41c11040" title="Obtain the FrameContext for the frame.">get()</a>, typically when the IPA module is requested to provide sensor or ISP parameters or receives statistics for a frame. The frame number is used at that point to identify the context.</p>
<p>If an application fails to queue requests to the camera fast enough, frames may be produced by the camera sensor and processed by the IPA module without a corresponding request having been queued to the IPA module. This creates an underrun condition, where the IPA module will try to get a frame context that hasn't been allocated. In this case, the <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a280f05d67bf0803ac96b777b41c11040" title="Obtain the FrameContext for the frame.">get()</a> function will allocate and initialize a context for the frame, and log a message. Algorithms will not apply the controls associated with the late request, but should otherwise behave correctly.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>Mark the frame context with a per-frame control error flag in case of underrun, and research how algorithms should handle this.</dd></dl>
<p>At its core, the queue uses a circular buffer to avoid dynamic memory allocation at runtime. The buffer is pre-allocated with a maximum number of entries when the <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html" title="A support class for managing FrameContext instances in IPA modules.">FCQueue</a> instance is constructed. Entries are initialized on first use by <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a30a8f9b03de53964effa77b76aeef6e5" title="Allocate and return a FrameContext for the frame.">alloc()</a> or, in underrun conditions, <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html#a280f05d67bf0803ac96b777b41c11040" title="Obtain the FrameContext for the frame.">get()</a>. The queue is not allowed to overflow, which must be ensured by pipeline handlers never queuing more in-flight requests to the IPA module than the queue size. If an overflow condition is detected, the queue will log a fatal error.</p>
<p>IPA module-specific frame context implementations shall inherit from the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> base class to support the minimum required features for a <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a>. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a04b07447b9ff942b5bdb35f22110876f" name="a04b07447b9ff942b5bdb35f22110876f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04b07447b9ff942b5bdb35f22110876f">&#9670;&#160;</a></span>FCQueue()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html">libcamera::ipa::FCQueue</a>&lt; <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt;::FCQueue </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a frame contexts queue of a specified size. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>The number of contexts in the queue </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a30a8f9b03de53964effa77b76aeef6e5" name="a30a8f9b03de53964effa77b76aeef6e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30a8f9b03de53964effa77b76aeef6e5">&#9670;&#160;</a></span>alloc()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html">libcamera::ipa::FCQueue</a>&lt; <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt;::alloc </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate and return a <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> for the <em>frame</em>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">frame</td><td>The frame context sequence number</td></tr>
  </table>
  </dd>
</dl>
<p>The first call to obtain a <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> from the <a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html" title="A support class for managing FrameContext instances in IPA modules.">FCQueue</a> should be handled through this function. The <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> will be initialised, if not initialised already, and returned to the caller.</p>
<p>If the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> was already initialized for this <em>frame</em>, a warning will be reported and the previously initialized <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> is returned.</p>
<p>Frame contexts are expected to be initialised when a <a class="el" href="classlibcamera_1_1Request.html" title="A frame capture request.">Request</a> is first passed to the IPA module in IPAModule::queueRequest().</p>
<dl class="section return"><dt>Returns</dt><dd>A reference to the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> for sequence <em>frame</em> </dd></dl>

</div>
</div>
<a id="a7a76eebb86d4d5b41fff9d4e950fb385" name="a7a76eebb86d4d5b41fff9d4e950fb385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a76eebb86d4d5b41fff9d4e950fb385">&#9670;&#160;</a></span>clear()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html">libcamera::ipa::FCQueue</a>&lt; <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt;::clear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Clear the contexts queue. </p>
<p>IPA modules must clear the frame context queue at the beginning of a new streaming session, in IPAModule::start().</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Fix any issue this may cause with requests queued before the camera is started. </dd></dl>

</div>
</div>
<a id="a280f05d67bf0803ac96b777b41c11040" name="a280f05d67bf0803ac96b777b41c11040"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a280f05d67bf0803ac96b777b41c11040">&#9670;&#160;</a></span>get()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlibcamera_1_1ipa_1_1FCQueue.html">libcamera::ipa::FCQueue</a>&lt; <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html">FrameContext</a> &gt;::get </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Obtain the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> for the <em>frame</em>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">frame</td><td>The frame context sequence number</td></tr>
  </table>
  </dd>
</dl>
<p>If the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> is not correctly initialised for the <em>frame</em>, it will be initialised.</p>
<dl class="section return"><dt>Returns</dt><dd>A reference to the <a class="el" href="structlibcamera_1_1ipa_1_1FrameContext.html" title="Context for a frame.">FrameContext</a> for sequence <em>frame</em> </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/peripherals/camera/libcamera/src/ipa/libipa/<a class="el" href="fc__queue_8h_source.html">fc_queue.h</a></li>
<li>src/peripherals/camera/libcamera/src/ipa/libipa/<b>fc_queue.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
