\doxysection{libcamera\+::ipa\+::ipu3\+::algorithms\+::Awb Class Reference}
\hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb}{}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb}\index{libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}}


A Grey world white balance correction algorithm.  


Inheritance diagram for libcamera\+::ipa\+::ipu3\+::algorithms\+::Awb\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a09f761dee16ea322dd343d63e234a874}{configure}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const IPAConfig\+Info \&config\+Info) override
\begin{DoxyCompactList}\small\item\em Configure the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} given an IPAConfig\+Info.   \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a525add4516a50bb8e9d82f4ab10da17e}{prepare}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const uint32\+\_\+t frame, \mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&frame\+Context, \mbox{\hyperlink{structipu3__uapi__params}{ipu3\+\_\+uapi\+\_\+params}} \texorpdfstring{$\ast$}{*}params) override
\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a85b4f58b1c62a7aeaf5f073698679a39}{process}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const uint32\+\_\+t frame, \mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&frame\+Context, const \mbox{\hyperlink{structipu3__uapi__stats__3a}{ipu3\+\_\+uapi\+\_\+stats\+\_\+3a}} \texorpdfstring{$\ast$}{*}stats, \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&metadata) override
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm}{libcamera\+::ipa\+::\+Algorithm$<$ Module $>$}}}
\begin{DoxyCompactItemize}
\item 
virtual int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a68ad78f4d948f8cebefaaae22b743687}{init}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const \mbox{\hyperlink{classlibcamera_1_1YamlObject}{Yaml\+Object}} \&tuning\+Data)
\begin{DoxyCompactList}\small\item\em Initialize the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} with tuning data. \end{DoxyCompactList}\item 
virtual int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a5e3cd461b46cdd1d366bf211f87d8f3d}{configure}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a7c0b7a42c526c07bafeca4018b38b8c9}{Module\+::\+Config}} \&config\+Info)
\begin{DoxyCompactList}\small\item\em Configure the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} given an IPAConfig\+Info. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a307cf5dd6b48ccc1c772901c07e14afe}{queue\+Request}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, const \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&controls)
\begin{DoxyCompactList}\small\item\em Provide control values to the algorithm. \end{DoxyCompactList}\item 
virtual void {\bfseries prepare} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a48ee62113eed1c9ad7a001887dc59674}{Module\+::\+Params}} \texorpdfstring{$\ast$}{*}params)
\item 
virtual void {\bfseries process} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, const typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_afdcea0695dc0eb1226d66442a5647a41}{Module\+::\+Stats}} \texorpdfstring{$\ast$}{*}stats, \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&metadata)
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Public Types inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm}{libcamera\+::ipa\+::\+Algorithm$<$ Module $>$}}}
\begin{DoxyCompactItemize}
\item 
using {\bfseries Module} = \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_ac52491716c9cd932770dc1a02d7d9b25}{Module}}
\begin{DoxyCompactList}\small\item\em The IPA module type for this class of algorithms. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
A Grey world white balance correction algorithm. 

The Grey World algorithm assumes that the scene, in average, is neutral grey. Reference\+: Lam, Edmund \& Fung, George. (2008). Automatic White Balancing in Digital Photography. 10.\+1201/9781420054538.ch10.

The IPU3 generates statistics from the Bayer Down Scaler output into a grid defined in the \doxylink{structipu3__uapi__awb__config__s}{ipu3\+\_\+uapi\+\_\+awb\+\_\+config\+\_\+s} structure.


\begin{DoxyItemize}
\item Cells are defined in Pixels
\item Zones are defined in Cells \begin{DoxyVerb}                      80 cells
     /───────────── 1280 pixels ───────────\
                      16 zones
      16
    ┌────┬────┬────┬────┬────┬─  ──────┬────┐   \
    │Cell│    │    │    │    │    |    │    │   │
 16 │ px │    │    │    │    │    |    │    │   │
    ├────┼────┼────┼────┼────┼─  ──────┼────┤   │
    │    │    │    │    │    │    |    │    │
    │    │    │    │    │    │    |    │    │   7
    │ ── │ ── │ ── │ ── │ ── │ ──  ── ─┤ ── │ 1 2 4
    │    │    │    │    │    │    |    │    │ 2 0 5

    │    │    │    │    │    │    |    │    │ z p c
    ├────┼────┼────┼────┼────┼─  ──────┼────┤ o i e
    │    │    │    │    │    │    |    │    │ n x l
    │                        │    |    │    │ e e l
    ├───                  ───┼─  ──────┼────┤ s l s
    │                        │    |    │    │   s
    │                        │    |    │    │
    ├───   Zone of Cells  ───┼─  ──────┼────┤   │
    │        (5 x 4)         │    |    │    │   │
    │                        │    |    │    │   │
    ├──                   ───┼─  ──────┼────┤   │
    │                   │    │    |    │    │   │
    │    │    │    │    │    │    |    │    │   │
    └────┴────┴────┴────┴────┴─  ──────┴────┘   /
\end{DoxyVerb}

\end{DoxyItemize}

In each cell, the ImgU computes for each colour component the average of all unsaturated pixels (below a programmable threshold). It also provides the ratio of saturated pixels in the cell.

The AWB algorithm operates on a coarser grid, made by grouping cells from the hardware grid into zones. The number of zones is fixed to {\itshape k\+Awb\+Stats\+SizeX} x {\itshape k\+Awb\+Stats\+SizeY}. For example, a frame of 1280x720 is divided into 80x45 cells of \mbox{[}16x16\mbox{]} pixels and 16x12 zones of \mbox{[}5x4\mbox{]} cells each ({\itshape k\+Awb\+Stats\+SizeX=16} and {\itshape k\+Awb\+Stats\+SizeY=12}). If the number of cells isn\textquotesingle{}t an exact multiple of the number of zones, the right-\/most and bottom-\/most cells are ignored. The grid configuration is computed by IPAIPU3\+::calculate\+Bds\+Grid().

Before calculating the gains, the algorithm aggregates the cell averages for each zone in generate\+Awb\+Stats(). Cells that have a too high ratio of saturated pixels are ignored, and only zones that contain enough non-\/saturated cells are then used by the algorithm.

The Grey World algorithm will then estimate the red and blue gains to apply, and store the results in the metadata. The green gain is always set to 1. 

\doxysubsection{Member Function Documentation}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a09f761dee16ea322dd343d63e234a874}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a09f761dee16ea322dd343d63e234a874} 
\index{libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}!configure@{configure}}
\index{configure@{configure}!libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}}
\doxysubsubsection{\texorpdfstring{configure()}{configure()}}
{\footnotesize\ttfamily int libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Awb\+::configure (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const IPAConfig\+Info \&}]{config\+Info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}



Configure the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} given an IPAConfig\+Info.   


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & The shared IPA context \\
\hline
\mbox{\texttt{ in}}  & {\em config\+Info} & The IPA configuration data, received from the pipeline handler\\
\hline
\end{DoxyParams}
Algorithms may implement a configure operation to pre-\/calculate parameters prior to commencing streaming.

Configuration state may be stored in the \doxylink{structlibcamera_1_1ipa_1_1ipu3_1_1IPASessionConfiguration}{IPASession\+Configuration} structure of the \doxylink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}.

\begin{DoxyReturn}{Returns}
0 if successful, an error code otherwise   
\end{DoxyReturn}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a525add4516a50bb8e9d82f4ab10da17e}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a525add4516a50bb8e9d82f4ab10da17e} 
\index{libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}!prepare@{prepare}}
\index{prepare@{prepare}!libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}}
\doxysubsubsection{\texorpdfstring{prepare()}{prepare()}}
{\footnotesize\ttfamily void libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Awb\+::prepare (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const uint32\+\_\+t}]{frame,  }\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&}]{frame\+Context,  }\item[{\mbox{\hyperlink{structipu3__uapi__params}{ipu3\+\_\+uapi\+\_\+params}} \texorpdfstring{$\ast$}{*}}]{params }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}





\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a85b4f58b1c62a7aeaf5f073698679a39}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Awb_a85b4f58b1c62a7aeaf5f073698679a39} 
\index{libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}!process@{process}}
\index{process@{process}!libcamera::ipa::ipu3::algorithms::Awb@{libcamera::ipa::ipu3::algorithms::Awb}}
\doxysubsubsection{\texorpdfstring{process()}{process()}}
{\footnotesize\ttfamily void libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Awb\+::process (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const uint32\+\_\+t}]{frame,  }\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&}]{frame\+Context,  }\item[{const \mbox{\hyperlink{structipu3__uapi__stats__3a}{ipu3\+\_\+uapi\+\_\+stats\+\_\+3a}} \texorpdfstring{$\ast$}{*}}]{stats,  }\item[{\mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&}]{metadata }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}







The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/peripherals/camera/libcamera/src/ipa/ipu3/algorithms/\mbox{\hyperlink{ipu3_2algorithms_2awb_8h}{awb.\+h}}\item 
src/peripherals/camera/libcamera/src/ipa/ipu3/algorithms/awb.\+cpp\end{DoxyCompactItemize}
