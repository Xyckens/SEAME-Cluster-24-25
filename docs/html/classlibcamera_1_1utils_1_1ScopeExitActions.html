<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JetPackJoyRide: libcamera::utils::ScopeExitActions Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JetPackJoyRide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibcamera.html">libcamera</a></li><li class="navelem"><b>utils</b></li><li class="navelem"><a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html">ScopeExitActions</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlibcamera_1_1utils_1_1ScopeExitActions-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">libcamera::utils::ScopeExitActions Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>An object that performs actions upon destruction.  
 <a href="classlibcamera_1_1utils_1_1ScopeExitActions.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a60c24bffd971358b7d9b4ba45da08bb1" id="r_a60c24bffd971358b7d9b4ba45da08bb1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html#a60c24bffd971358b7d9b4ba45da08bb1">operator+=</a> (std::function&lt; void()&gt; &amp;&amp;action)</td></tr>
<tr class="memdesc:a60c24bffd971358b7d9b4ba45da08bb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an exit action.  <br /></td></tr>
<tr class="separator:a60c24bffd971358b7d9b4ba45da08bb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d8e102346d5c87d01eaa0e7993751f8" id="r_a2d8e102346d5c87d01eaa0e7993751f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html#a2d8e102346d5c87d01eaa0e7993751f8">release</a> ()</td></tr>
<tr class="memdesc:a2d8e102346d5c87d01eaa0e7993751f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove all exit actions.  <br /></td></tr>
<tr class="separator:a2d8e102346d5c87d01eaa0e7993751f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>An object that performs actions upon destruction. </p>
<p>The <a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html" title="An object that performs actions upon destruction.">ScopeExitActions</a> class is a simple object that performs user-provided actions upon destruction. It is meant to simplify cleanup tasks in error handling paths.</p>
<p>When the code flow performs multiple sequential actions that each need a corresponding cleanup action, error handling quickly become tedious:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = allocateMemory();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line"> </div>
<div class="line">    ret = startProducer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        freeMemory();</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = startConsumer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        stopProducer();</div>
<div class="line">        freeMemory();</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is prone to programming mistakes, as cleanup actions can easily be forgotten or ordered incorrectly. One strategy to simplify error handling is to use goto statements:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = allocateMemory();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line"> </div>
<div class="line">    ret = startProducer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">goto</span> error_free;</div>
<div class="line"> </div>
<div class="line">    ret = startConsumer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">goto</span> error_stop;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">error_stop:</div>
<div class="line">    stopProducer();</div>
<div class="line">error_free:</div>
<div class="line">    freeMemory();</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment --><p>While this may be considered better, this solution is still quite error-prone. Beside the risk of picking the wrong error label, the error handling logic is separated from the normal code flow, which increases the risk of error when refactoring the code. Additionally, C++ doesn't allow goto statements to jump over local variable declarations, which can make usage of this pattern more difficult.</p>
<p>The <a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html" title="An object that performs actions upon destruction.">ScopeExitActions</a> class solves these issues by allowing code that requires cleanup actions to be grouped with its corresponding error handling code:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code hl_class" href="classlibcamera_1_1utils_1_1ScopeExitActions.html">ScopeExitActions</a> actions;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> ret = allocateMemory();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line"> </div>
<div class="line">    actions += [&amp;]() { freeMemory(); };</div>
<div class="line"> </div>
<div class="line">    ret = startProducer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line"> </div>
<div class="line">    actions += [&amp;]() { stopProducer(); };</div>
<div class="line"> </div>
<div class="line">    ret = startConsumer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line"> </div>
<div class="line">    actions.<a class="code hl_function" href="classlibcamera_1_1utils_1_1ScopeExitActions.html#a2d8e102346d5c87d01eaa0e7993751f8">release</a>();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasslibcamera_1_1utils_1_1ScopeExitActions_html"><div class="ttname"><a href="classlibcamera_1_1utils_1_1ScopeExitActions.html">libcamera::utils::ScopeExitActions</a></div><div class="ttdoc">An object that performs actions upon destruction.</div><div class="ttdef"><b>Definition</b> utils.h:419</div></div>
<div class="ttc" id="aclasslibcamera_1_1utils_1_1ScopeExitActions_html_a2d8e102346d5c87d01eaa0e7993751f8"><div class="ttname"><a href="classlibcamera_1_1utils_1_1ScopeExitActions.html#a2d8e102346d5c87d01eaa0e7993751f8">libcamera::utils::ScopeExitActions::release</a></div><div class="ttdeci">void release()</div><div class="ttdoc">Remove all exit actions.</div><div class="ttdef"><b>Definition</b> utils.cpp:646</div></div>
</div><!-- fragment --><p>Error handlers are executed when the <a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html" title="An object that performs actions upon destruction.">ScopeExitActions</a> instance is destroyed, in the reverse order of their addition. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a60c24bffd971358b7d9b4ba45da08bb1" name="a60c24bffd971358b7d9b4ba45da08bb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60c24bffd971358b7d9b4ba45da08bb1">&#9670;&#160;</a></span>operator+=()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libcamera::utils::ScopeExitActions::operator+= </td>
          <td>(</td>
          <td class="paramtype">std::function&lt; void()&gt; &amp;&amp;&#160;</td>
          <td class="paramname"><em>action</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an exit action. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">action</td><td>The action</td></tr>
  </table>
  </dd>
</dl>
<p>Add an exit action to the <a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html" title="An object that performs actions upon destruction.">ScopeExitActions</a>. Actions will be called upon destruction in the reverse order of their addition. </p>

</div>
</div>
<a id="a2d8e102346d5c87d01eaa0e7993751f8" name="a2d8e102346d5c87d01eaa0e7993751f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d8e102346d5c87d01eaa0e7993751f8">&#9670;&#160;</a></span>release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libcamera::utils::ScopeExitActions::release </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove all exit actions. </p>
<p>This function should be called in scope exit paths that don't need the actions to be executed, such as success return paths from a function when the <a class="el" href="classlibcamera_1_1utils_1_1ScopeExitActions.html" title="An object that performs actions upon destruction.">ScopeExitActions</a> is used for error cleanup. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/peripherals/camera/libcamera/include/libcamera/base/<a class="el" href="include_2libcamera_2base_2utils_8h_source.html">utils.h</a></li>
<li>src/peripherals/camera/libcamera/src/libcamera/base/<b>utils.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
