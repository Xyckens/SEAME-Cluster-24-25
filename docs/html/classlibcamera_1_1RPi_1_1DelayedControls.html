<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JetPackJoyRide: libcamera::RPi::DelayedControls Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JetPackJoyRide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibcamera.html">libcamera</a></li><li class="navelem"><b>RPi</b></li><li class="navelem"><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html">DelayedControls</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlibcamera_1_1RPi_1_1DelayedControls-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">libcamera::RPi::DelayedControls Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Helper to deal with controls that take effect with a delay.  
 <a href="classlibcamera_1_1RPi_1_1DelayedControls.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlibcamera_1_1RPi_1_1DelayedControls_1_1ControlParams.html">ControlParams</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameters associated with controls handled by the <em><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html" title="Helper to deal with controls that take effect with a delay.">DelayedControls</a></em> helper class.  <a href="structlibcamera_1_1RPi_1_1DelayedControls_1_1ControlParams.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af9c8cbdd8385dcc77802e65430b409c9" id="r_af9c8cbdd8385dcc77802e65430b409c9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html#af9c8cbdd8385dcc77802e65430b409c9">DelayedControls</a> (<a class="el" href="classlibcamera_1_1V4L2Device.html">V4L2Device</a> *device, const std::unordered_map&lt; uint32_t, <a class="el" href="structlibcamera_1_1RPi_1_1DelayedControls_1_1ControlParams.html">ControlParams</a> &gt; &amp;controlParams)</td></tr>
<tr class="memdesc:af9c8cbdd8385dcc77802e65430b409c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a <a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html" title="Helper to deal with controls that take effect with a delay.">DelayedControls</a> instance.  <br /></td></tr>
<tr class="separator:af9c8cbdd8385dcc77802e65430b409c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40027499f95f2b4bd7669c56081c5bda" id="r_a40027499f95f2b4bd7669c56081c5bda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html#a40027499f95f2b4bd7669c56081c5bda">reset</a> (unsigned int cookie)</td></tr>
<tr class="memdesc:a40027499f95f2b4bd7669c56081c5bda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset state machine.  <br /></td></tr>
<tr class="separator:a40027499f95f2b4bd7669c56081c5bda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac31b2b6fa78124f95031745038c94496" id="r_ac31b2b6fa78124f95031745038c94496"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html#ac31b2b6fa78124f95031745038c94496">push</a> (const <a class="el" href="classlibcamera_1_1ControlList.html">ControlList</a> &amp;controls, unsigned int cookie)</td></tr>
<tr class="memdesc:ac31b2b6fa78124f95031745038c94496"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push a set of controls on the queue.  <br /></td></tr>
<tr class="separator:ac31b2b6fa78124f95031745038c94496"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d037ab49fca8270f2722e8abd4439c6" id="r_a0d037ab49fca8270f2722e8abd4439c6"><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classlibcamera_1_1ControlList.html">ControlList</a>, unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html#a0d037ab49fca8270f2722e8abd4439c6">get</a> (uint32_t sequence)</td></tr>
<tr class="memdesc:a0d037ab49fca8270f2722e8abd4439c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read back controls in effect at a sequence number.  <br /></td></tr>
<tr class="separator:a0d037ab49fca8270f2722e8abd4439c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ed544146e8202857b73c19d705870ad" id="r_a3ed544146e8202857b73c19d705870ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html#a3ed544146e8202857b73c19d705870ad">applyControls</a> (uint32_t sequence)</td></tr>
<tr class="memdesc:a3ed544146e8202857b73c19d705870ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inform <a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html" title="Helper to deal with controls that take effect with a delay.">DelayedControls</a> of the start of a new frame.  <br /></td></tr>
<tr class="separator:a3ed544146e8202857b73c19d705870ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper to deal with controls that take effect with a delay. </p>
<p>Some sensor controls take effect with a delay as the sensor needs time to adjust, for example exposure and analog gain. This is a helper class to deal with such controls and the intended users are pipeline handlers.</p>
<p>The idea is to extend the concept of the buffer depth of a pipeline the application needs to maintain to also cover controls. Just as with buffer depth if the application keeps the number of requests queued above the control depth the controls are guaranteed to take effect for the correct request. The control depth is determined by the control with the greatest delay. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="af9c8cbdd8385dcc77802e65430b409c9" name="af9c8cbdd8385dcc77802e65430b409c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9c8cbdd8385dcc77802e65430b409c9">&#9670;&#160;</a></span>DelayedControls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">libcamera::RPi::DelayedControls::DelayedControls </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlibcamera_1_1V4L2Device.html">V4L2Device</a> *&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::unordered_map&lt; uint32_t, <a class="el" href="structlibcamera_1_1RPi_1_1DelayedControls_1_1ControlParams.html">ControlParams</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>controlParams</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct a <a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html" title="Helper to deal with controls that take effect with a delay.">DelayedControls</a> instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>The V4L2 device the controls have to be applied to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">controlParams</td><td>Map of the numerical V4L2 control ids to their associated control parameters.</td></tr>
  </table>
  </dd>
</dl>
<p>The control parameters comprise of delays (in frames) and a priority write flag. If this flag is set, the relevant control is written separately from, and ahead of the rest of the batched controls.</p>
<p>Only controls specified in <em>controlParams</em> are handled. If it's desired to mix delayed controls and controls that take effect immediately the immediate controls must be listed in the <em>controlParams</em> map with a delay value of 0. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a3ed544146e8202857b73c19d705870ad" name="a3ed544146e8202857b73c19d705870ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ed544146e8202857b73c19d705870ad">&#9670;&#160;</a></span>applyControls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libcamera::RPi::DelayedControls::applyControls </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>sequence</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inform <a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html" title="Helper to deal with controls that take effect with a delay.">DelayedControls</a> of the start of a new frame. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sequence</td><td>Sequence number of the frame that started</td></tr>
  </table>
  </dd>
</dl>
<p>Inform the state machine that a new frame has started and of its sequence number. Any user of these helpers is responsible to inform the helper about the start of any frame. This can be connected with ease to the start of a exposure (SOE) V4L2 event. </p>

</div>
</div>
<a id="a0d037ab49fca8270f2722e8abd4439c6" name="a0d037ab49fca8270f2722e8abd4439c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d037ab49fca8270f2722e8abd4439c6">&#9670;&#160;</a></span>get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classlibcamera_1_1ControlList.html">ControlList</a>, unsigned int &gt; libcamera::RPi::DelayedControls::get </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>sequence</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read back controls in effect at a sequence number. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sequence</td><td>The sequence number to get controls for</td></tr>
  </table>
  </dd>
</dl>
<p>Read back what controls where in effect at a specific sequence number. The history is a ring buffer of 16 entries where new and old values coexist. It's the callers responsibility to not read too old sequence numbers that have been pushed out of the history.</p>
<p>Historic values are evicted by pushing new values onto the queue using <a class="el" href="classlibcamera_1_1RPi_1_1DelayedControls.html#ac31b2b6fa78124f95031745038c94496" title="Push a set of controls on the queue.">push()</a>. The max history from the current sequence number that yields valid values are thus 16 minus number of controls pushed.</p>
<dl class="section return"><dt>Returns</dt><dd>The controls at <em>sequence</em> number </dd></dl>

</div>
</div>
<a id="ac31b2b6fa78124f95031745038c94496" name="ac31b2b6fa78124f95031745038c94496"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac31b2b6fa78124f95031745038c94496">&#9670;&#160;</a></span>push()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool libcamera::RPi::DelayedControls::push </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibcamera_1_1ControlList.html">ControlList</a> &amp;&#160;</td>
          <td class="paramname"><em>controls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cookie</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Push a set of controls on the queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">controls</td><td>List of controls to add to the device queue</td></tr>
  </table>
  </dd>
</dl>
<p>Push a set of controls to the control queue. This increases the control queue depth by one.</p>
<dl class="section return"><dt>Returns</dt><dd>true if <em>controls</em> are accepted, or false otherwise </dd></dl>

</div>
</div>
<a id="a40027499f95f2b4bd7669c56081c5bda" name="a40027499f95f2b4bd7669c56081c5bda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40027499f95f2b4bd7669c56081c5bda">&#9670;&#160;</a></span>reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libcamera::RPi::DelayedControls::reset </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cookie</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset state machine. </p>
<p>Resets the state machine to a starting position based on control values retrieved from the device. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/peripherals/camera/libcamera/src/libcamera/pipeline/rpi/common/<a class="el" href="src_2libcamera_2pipeline_2rpi_2common_2delayed__controls_8h_source.html">delayed_controls.h</a></li>
<li>src/peripherals/camera/libcamera/src/libcamera/pipeline/rpi/common/<b>delayed_controls.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
