\doxysection{camera3\+\_\+device\+\_\+ops Struct Reference}
\hypertarget{structcamera3__device__ops}{}\label{structcamera3__device__ops}\index{camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
int(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_aa51b8c64f3f990d670a6fcc7ac51eb18}{initialize}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, const \mbox{\hyperlink{structcamera3__callback__ops}{camera3\+\_\+callback\+\_\+ops\+\_\+t}} \texorpdfstring{$\ast$}{*}callback\+\_\+ops)
\item 
int(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, \mbox{\hyperlink{structcamera3__stream__configuration}{camera3\+\_\+stream\+\_\+configuration\+\_\+t}} \texorpdfstring{$\ast$}{*}stream\+\_\+list)
\item 
int(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, const \mbox{\hyperlink{structcamera3__stream__buffer__set}{camera3\+\_\+stream\+\_\+buffer\+\_\+set\+\_\+t}} \texorpdfstring{$\ast$}{*}buffer\+\_\+set)
\item 
const camera\+\_\+metadata\+\_\+t \texorpdfstring{$\ast$}{*}(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_a62f50128c03367c3ab96e44f353bc757}{construct\+\_\+default\+\_\+request\+\_\+settings}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, int type)
\item 
int(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, \mbox{\hyperlink{structcamera3__capture__request}{camera3\+\_\+capture\+\_\+request\+\_\+t}} \texorpdfstring{$\ast$}{*}request)
\item 
void(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_a7de94cf09d810a65119dd4aab5101439}{get\+\_\+metadata\+\_\+vendor\+\_\+tag\+\_\+ops}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, \mbox{\hyperlink{structvendor__tag__query__ops}{vendor\+\_\+tag\+\_\+query\+\_\+ops\+\_\+t}} \texorpdfstring{$\ast$}{*}ops)
\item 
void(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_ac82f059e14fceb6ac4975c52805d091d}{dump}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, int fd)
\item 
int(\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush}} )(const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*})
\item 
\Hypertarget{structcamera3__device__ops_ad2038d2ed41e5f4f7512b97e11a43acb}\label{structcamera3__device__ops_ad2038d2ed41e5f4f7512b97e11a43acb} 
void \texorpdfstring{$\ast$}{*} {\bfseries reserved} \mbox{[}8\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Member Data Documentation}
\Hypertarget{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}\label{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!configure\_streams@{configure\_streams}}
\index{configure\_streams@{configure\_streams}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{configure\_streams}{configure\_streams}}
{\footnotesize\ttfamily int(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::configure\+\_\+streams) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, \mbox{\hyperlink{structcamera3__stream__configuration}{camera3\+\_\+stream\+\_\+configuration\+\_\+t}} \texorpdfstring{$\ast$}{*}stream\+\_\+list)}

configure\+\_\+streams\+:

CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+0 only\+:

Reset the HAL camera device processing pipeline and set up new input and output streams. This call replaces any existing stream configuration with the streams defined in the stream\+\_\+list. This method will be called at least once after \doxylink{structcamera3__device__ops_aa51b8c64f3f990d670a6fcc7ac51eb18}{initialize()} before a request is submitted with \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()}.

The stream\+\_\+list must contain at least one output-\/capable stream, and may not contain more than one input-\/capable stream.

The stream\+\_\+list may contain streams that are also in the currently-\/active set of streams (from the previous call to configure\+\_\+stream()). These streams will already have valid values for usage, max\+\_\+buffers, and the private pointer.

If such a stream has already had its buffers registered, \doxylink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers()} will not be called again for the stream, and buffers from the stream can be immediately included in input requests.

If the HAL needs to change the stream configuration for an existing stream due to the new configuration, it may rewrite the values of usage and/or max\+\_\+buffers during the configure call.

The framework will detect such a change, and will then reallocate the stream buffers, and call \doxylink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers()} again before using buffers from that stream in a request.

If a currently-\/active stream is not included in stream\+\_\+list, the HAL may safely remove any references to that stream. It will not be reused in a later configure() call by the framework, and all the gralloc buffers for it will be freed after the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call returns.

The stream\+\_\+list structure is owned by the framework, and may not be accessed once this call completes. The address of an individual camera3\+\_\+stream\+\_\+t structure will remain valid for access by the HAL until the end of the first configure\+\_\+stream() call which no longer includes that camera3\+\_\+stream\+\_\+t in the stream\+\_\+list argument. The HAL may not change values in the stream structure outside of the private pointer, except for the usage and max\+\_\+buffers members during the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call itself.

If the stream is new, the usage, max\+\_\+buffer, and private pointer fields of the stream structure will all be set to 0. The HAL device must set these fields before the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call returns. These fields are then used by the framework and the platform gralloc module to allocate the gralloc buffers for each stream.

Before such a new stream can have its buffers included in a capture request, the framework will call \doxylink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers()} with that stream. However, the framework is not required to register buffers for {\itshape all} streams before submitting a request. This allows for quick startup of (for example) a preview stream, with allocation for other streams happening later or concurrently.

\DoxyHorRuler{0}
 CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+1 only\+:

Reset the HAL camera device processing pipeline and set up new input and output streams. This call replaces any existing stream configuration with the streams defined in the stream\+\_\+list. This method will be called at least once after \doxylink{structcamera3__device__ops_aa51b8c64f3f990d670a6fcc7ac51eb18}{initialize()} before a request is submitted with \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()}.

The stream\+\_\+list must contain at least one output-\/capable stream, and may not contain more than one input-\/capable stream.

The stream\+\_\+list may contain streams that are also in the currently-\/active set of streams (from the previous call to configure\+\_\+stream()). These streams will already have valid values for usage, max\+\_\+buffers, and the private pointer.

If such a stream has already had its buffers registered, \doxylink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers()} will not be called again for the stream, and buffers from the stream can be immediately included in input requests.

If the HAL needs to change the stream configuration for an existing stream due to the new configuration, it may rewrite the values of usage and/or max\+\_\+buffers during the configure call.

The framework will detect such a change, and will then reallocate the stream buffers, and call \doxylink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers()} again before using buffers from that stream in a request.

If a currently-\/active stream is not included in stream\+\_\+list, the HAL may safely remove any references to that stream. It will not be reused in a later configure() call by the framework, and all the gralloc buffers for it will be freed after the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call returns.

The stream\+\_\+list structure is owned by the framework, and may not be accessed once this call completes. The address of an individual camera3\+\_\+stream\+\_\+t structure will remain valid for access by the HAL until the end of the first configure\+\_\+stream() call which no longer includes that camera3\+\_\+stream\+\_\+t in the stream\+\_\+list argument. The HAL may not change values in the stream structure outside of the private pointer, except for the usage and max\+\_\+buffers members during the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call itself.

If the stream is new, max\+\_\+buffer, and private pointer fields of the stream structure will all be set to 0. The usage will be set to the consumer usage flags. The HAL device must set these fields before the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call returns. These fields are then used by the framework and the platform gralloc module to allocate the gralloc buffers for each stream.

Before such a new stream can have its buffers included in a capture request, the framework will call \doxylink{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}{register\+\_\+stream\+\_\+buffers()} with that stream. However, the framework is not required to register buffers for {\itshape all} streams before submitting a request. This allows for quick startup of (for example) a preview stream, with allocation for other streams happening later or concurrently.

\DoxyHorRuler{0}
 \texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+2\+:

Reset the HAL camera device processing pipeline and set up new input and output streams. This call replaces any existing stream configuration with the streams defined in the stream\+\_\+list. This method will be called at least once after \doxylink{structcamera3__device__ops_aa51b8c64f3f990d670a6fcc7ac51eb18}{initialize()} before a request is submitted with \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()}.

The stream\+\_\+list must contain at least one output-\/capable stream, and may not contain more than one input-\/capable stream.

The stream\+\_\+list may contain streams that are also in the currently-\/active set of streams (from the previous call to configure\+\_\+stream()). These streams will already have valid values for usage, max\+\_\+buffers, and the private pointer.

If the HAL needs to change the stream configuration for an existing stream due to the new configuration, it may rewrite the values of usage and/or max\+\_\+buffers during the configure call.

The framework will detect such a change, and may then reallocate the stream buffers before using buffers from that stream in a request.

If a currently-\/active stream is not included in stream\+\_\+list, the HAL may safely remove any references to that stream. It will not be reused in a later configure() call by the framework, and all the gralloc buffers for it will be freed after the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call returns.

The stream\+\_\+list structure is owned by the framework, and may not be accessed once this call completes. The address of an individual camera3\+\_\+stream\+\_\+t structure will remain valid for access by the HAL until the end of the first configure\+\_\+stream() call which no longer includes that camera3\+\_\+stream\+\_\+t in the stream\+\_\+list argument. The HAL may not change values in the stream structure outside of the private pointer, except for the usage and max\+\_\+buffers members during the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call itself.

If the stream is new, max\+\_\+buffer, and private pointer fields of the stream structure will all be set to 0. The usage will be set to the consumer usage flags. The HAL device must set these fields before the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call returns. These fields are then used by the framework and the platform gralloc module to allocate the gralloc buffers for each stream.

Newly allocated buffers may be included in a capture request at any time by the framework. Once a gralloc buffer is returned to the framework with process\+\_\+capture\+\_\+result (and its respective release\+\_\+fence has been signaled) the framework may free or reuse it at any time.

\DoxyHorRuler{0}


Preconditions\+:

The framework will only call this method when no captures are being processed. That is, all results have been returned to the framework, and all in-\/flight input and output buffers have been returned and their release sync fences have been signaled by the HAL. The framework will not submit new requests for capture while the \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call is underway.

Postconditions\+:

The HAL device must configure itself to provide maximum possible output frame rate given the sizes and formats of the output streams, as documented in the camera device\textquotesingle{}s static metadata.

Performance requirements\+:

This call is expected to be heavyweight and possibly take several hundred milliseconds to complete, since it may require resetting and reconfiguring the image sensor and the camera processing pipeline. Nevertheless, the HAL device should attempt to minimize the reconfiguration delay to minimize the user-\/visible pauses during application operational mode changes (such as switching from still capture to video recording).

The HAL should return from this call in 500ms, and must return from this call in 1000ms.

Return values\+:

0\+: On successful stream configuration

-\/EINVAL\+: If the requested stream configuration is invalid. Some examples of invalid stream configurations include\+:


\begin{DoxyItemize}
\item Including more than 1 input-\/capable stream (INPUT or BIDIRECTIONAL)
\item Not including any output-\/capable streams (OUTPUT or BIDIRECTIONAL)
\item Including streams with unsupported formats, or an unsupported size for that format.
\item Including too many output streams of a certain format.
\item Unsupported rotation configuration (only applies to devices with version \texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+3)
\item Stream sizes/formats don\textquotesingle{}t satisfy the camera3\+\_\+stream\+\_\+configuration\+\_\+t-\/\texorpdfstring{$>$}{>}operation\+\_\+mode requirements for non-\/\+NORMAL mode, or the requested operation\+\_\+mode is not supported by the HAL. (only applies to devices with version \texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+3)
\end{DoxyItemize}

Note that the framework submitting an invalid stream configuration is not normal operation, since stream configurations are checked before configure. An invalid configuration means that a bug exists in the framework code, or there is a mismatch between the HAL\textquotesingle{}s static metadata and the requirements on streams.

-\/ENODEV\+: If there has been a fatal error and the device is no longer operational. Only close() can be called successfully by the framework after this error is returned. \Hypertarget{structcamera3__device__ops_a62f50128c03367c3ab96e44f353bc757}\label{structcamera3__device__ops_a62f50128c03367c3ab96e44f353bc757} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!construct\_default\_request\_settings@{construct\_default\_request\_settings}}
\index{construct\_default\_request\_settings@{construct\_default\_request\_settings}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{construct\_default\_request\_settings}{construct\_default\_request\_settings}}
{\footnotesize\ttfamily const camera\+\_\+metadata\+\_\+t \texorpdfstring{$\ast$}{*}(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::construct\+\_\+default\+\_\+request\+\_\+settings) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, int type)}

construct\+\_\+default\+\_\+request\+\_\+settings\+:

Create capture settings for standard camera use cases.

The device must return a settings buffer that is configured to meet the requested use case, which must be one of the CAMERA3\+\_\+\+TEMPLATE\+\_\+\texorpdfstring{$\ast$}{*} enums. All request control fields must be included.

The HAL retains ownership of this structure, but the pointer to the structure must be valid until the device is closed. The framework and the HAL may not modify the buffer once it is returned by this call. The same buffer may be returned for subsequent calls for the same template, or for other templates.

Performance requirements\+:

This should be a non-\/blocking call. The HAL should return from this call in 1ms, and must return from this call in 5ms.

Return values\+:

Valid metadata\+: On successful creation of a default settings buffer.

NULL\+: In case of a fatal error. After this is returned, only the close() method can be called successfully by the framework. \Hypertarget{structcamera3__device__ops_ac82f059e14fceb6ac4975c52805d091d}\label{structcamera3__device__ops_ac82f059e14fceb6ac4975c52805d091d} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!dump@{dump}}
\index{dump@{dump}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{dump}{dump}}
{\footnotesize\ttfamily void(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::dump) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, int fd)}

dump\+:

Print out debugging state for the camera device. This will be called by the framework when the camera service is asked for a debug dump, which happens when using the dumpsys tool, or when capturing a bugreport.

The passed-\/in file descriptor can be used to write debugging text using dprintf() or write(). The text should be in ASCII encoding only.

Performance requirements\+:

This must be a non-\/blocking call. The HAL should return from this call in 1ms, must return from this call in 10ms. This call must avoid deadlocks, as it may be called at any point during camera operation. Any synchronization primitives used (such as mutex locks or semaphores) should be acquired with a timeout. \Hypertarget{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}\label{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!flush@{flush}}
\index{flush@{flush}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{flush}{flush}}
{\footnotesize\ttfamily int(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::flush) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*})}

flush\+:

Flush all currently in-\/process captures and all buffers in the pipeline on the given device. The framework will use this to dump all state as quickly as possible in order to prepare for a \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call.

No buffers are required to be successfully returned, so every buffer held at the time of \doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} (whether successfully filled or not) may be returned with CAMERA3\+\_\+\+BUFFER\+\_\+\+STATUS\+\_\+\+ERROR. Note the HAL is still allowed to return valid (CAMERA3\+\_\+\+BUFFER\+\_\+\+STATUS\+\_\+\+OK) buffers during this call, provided they are successfully filled.

All requests currently in the HAL are expected to be returned as soon as possible. Not-\/in-\/process requests should return errors immediately. Any interruptible hardware blocks should be stopped, and any uninterruptible blocks should be waited on.

\doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} may be called concurrently to \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()}, with the expectation that process\+\_\+capture\+\_\+request will return quickly and the request submitted in that process\+\_\+capture\+\_\+request call is treated like all other in-\/flight requests. Due to concurrency issues, it is possible that from the HAL\textquotesingle{}s point of view, a \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()} call may be started after flush has been invoked but has not returned yet. If such a call happens before \doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} returns, the HAL should treat the new capture request like other in-\/flight pending requests (see \#4 below).

More specifically, the HAL must follow below requirements for various cases\+:


\begin{DoxyEnumerate}
\item For captures that are too late for the HAL to cancel/stop, and will be completed normally by the HAL; i.\+e. the HAL can send shutter/notify and process\+\_\+capture\+\_\+result and buffers as normal.
\item For pending requests that have not done any processing, the HAL must call notify CAMERA3\+\_\+\+MSG\+\_\+\+ERROR\+\_\+\+REQUEST, and return all the output buffers with process\+\_\+capture\+\_\+result in the error state (CAMERA3\+\_\+\+BUFFER\+\_\+\+STATUS\+\_\+\+ERROR). The HAL must not place the release fence into an error state, instead, the release fences must be set to the acquire fences passed by the framework, or -\/1 if they have been waited on by the HAL already. This is also the path to follow for any captures for which the HAL already called notify() with CAMERA3\+\_\+\+MSG\+\_\+\+SHUTTER but won\textquotesingle{}t be producing any metadata/valid buffers for. After CAMERA3\+\_\+\+MSG\+\_\+\+ERROR\+\_\+\+REQUEST, for a given frame, only process\+\_\+capture\+\_\+results with buffers in CAMERA3\+\_\+\+BUFFER\+\_\+\+STATUS\+\_\+\+ERROR are allowed. No further notifys or process\+\_\+capture\+\_\+result with non-\/null metadata is allowed.
\item For partially completed pending requests that will not have all the output buffers or perhaps missing metadata, the HAL should follow below\+:

3.\+1. Call notify with CAMERA3\+\_\+\+MSG\+\_\+\+ERROR\+\_\+\+RESULT if some of the expected result metadata (i.\+e. one or more partial metadata) won\textquotesingle{}t be available for the capture.

3.\+2. Call notify with CAMERA3\+\_\+\+MSG\+\_\+\+ERROR\+\_\+\+BUFFER for every buffer that won\textquotesingle{}t be produced for the capture.

3.\+3 Call notify with CAMERA3\+\_\+\+MSG\+\_\+\+SHUTTER with the capture timestamp before any buffers/metadata are returned with process\+\_\+capture\+\_\+result.

3.\+4 For captures that will produce some results, the HAL must not call CAMERA3\+\_\+\+MSG\+\_\+\+ERROR\+\_\+\+REQUEST, since that indicates complete failure.

3.\+5. Valid buffers/metadata should be passed to the framework as normal.

3.\+6. Failed buffers should be returned to the framework as described for case 2. But failed buffers do not have to follow the strict ordering valid buffers do, and may be out-\/of-\/order with respect to valid buffers. For example, if buffers A, B, C, D, E are sent, D and E are failed, then A, E, B, D, C is an acceptable return order.

3.\+7. For fully-\/missing metadata, calling CAMERA3\+\_\+\+MSG\+\_\+\+ERROR\+\_\+\+RESULT is sufficient, no need to call process\+\_\+capture\+\_\+result with NULL metadata or equivalent.
\item If a \doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} is invoked while a \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()} invocation is active, that process call should return as soon as possible. In addition, if a \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()} call is made after \doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} has been invoked but before \doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} has returned, the capture request provided by the late process\+\_\+capture\+\_\+request call should be treated like a pending request in case \#2 above.
\end{DoxyEnumerate}

\doxylink{structcamera3__device__ops_a7d16aa280325309ac255f22d7ee0cb27}{flush()} should only return when there are no more outstanding buffers or requests left in the HAL. The framework may call configure\+\_\+streams (as the HAL state is now quiesced) or may issue new requests.

Note that it\textquotesingle{}s sufficient to only support fully-\/succeeded and fully-\/failed result cases. However, it is highly desirable to support the partial failure cases as well, as it could help improve the flush call overall performance.

Performance requirements\+:

The HAL should return from this call in 100ms, and must return from this call in 1000ms. And this call must not be blocked longer than pipeline latency (see S7 for definition).

Version information\+:

only available if device version \texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+1.

Return values\+:

0\+: On a successful flush of the camera HAL.

-\/EINVAL\+: If the input is malformed (the device is not valid).

-\/ENODEV\+: If the camera device has encountered a serious error. After this error is returned, only the close() method can be successfully called by the framework. \Hypertarget{structcamera3__device__ops_a7de94cf09d810a65119dd4aab5101439}\label{structcamera3__device__ops_a7de94cf09d810a65119dd4aab5101439} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!get\_metadata\_vendor\_tag\_ops@{get\_metadata\_vendor\_tag\_ops}}
\index{get\_metadata\_vendor\_tag\_ops@{get\_metadata\_vendor\_tag\_ops}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{get\_metadata\_vendor\_tag\_ops}{get\_metadata\_vendor\_tag\_ops}}
{\footnotesize\ttfamily void(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::get\+\_\+metadata\+\_\+vendor\+\_\+tag\+\_\+ops) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, \mbox{\hyperlink{structvendor__tag__query__ops}{vendor\+\_\+tag\+\_\+query\+\_\+ops\+\_\+t}} \texorpdfstring{$\ast$}{*}ops)}

get\+\_\+metadata\+\_\+vendor\+\_\+tag\+\_\+ops\+:

Get methods to query for vendor extension metadata tag information. The HAL should fill in all the vendor tag operation methods, or leave ops unchanged if no vendor tags are defined.

The definition of vendor\+\_\+tag\+\_\+query\+\_\+ops\+\_\+t can be found in system/media/camera/include/system/camera\+\_\+metadata.\+h.

\texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+2\+: DEPRECATED. This function has been deprecated and should be set to NULL by the HAL. Please implement get\+\_\+vendor\+\_\+tag\+\_\+ops in \doxylink{camera__common_8h_source}{camera\+\_\+common.\+h} instead. \Hypertarget{structcamera3__device__ops_aa51b8c64f3f990d670a6fcc7ac51eb18}\label{structcamera3__device__ops_aa51b8c64f3f990d670a6fcc7ac51eb18} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!initialize@{initialize}}
\index{initialize@{initialize}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{initialize}{initialize}}
{\footnotesize\ttfamily int(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::initialize) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, const \mbox{\hyperlink{structcamera3__callback__ops}{camera3\+\_\+callback\+\_\+ops\+\_\+t}} \texorpdfstring{$\ast$}{*}callback\+\_\+ops)}

initialize\+:

One-\/time initialization to pass framework callback function pointers to the HAL. Will be called once after a successful open() call, before any other functions are called on the \doxylink{structcamera3__device__ops}{camera3\+\_\+device\+\_\+ops} structure.

Performance requirements\+:

This should be a non-\/blocking call. The HAL should return from this call in 5ms, and must return from this call in 10ms.

Return values\+:

0\+: On successful initialization

-\/ENODEV\+: If initialization fails. Only close() can be called successfully by the framework after this. \Hypertarget{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}\label{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!process\_capture\_request@{process\_capture\_request}}
\index{process\_capture\_request@{process\_capture\_request}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{process\_capture\_request}{process\_capture\_request}}
{\footnotesize\ttfamily int(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::process\+\_\+capture\+\_\+request) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, \mbox{\hyperlink{structcamera3__capture__request}{camera3\+\_\+capture\+\_\+request\+\_\+t}} \texorpdfstring{$\ast$}{*}request)}

process\+\_\+capture\+\_\+request\+:

Send a new capture request to the HAL. The HAL should not return from this call until it is ready to accept the next request to process. Only one call to \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()} will be made at a time by the framework, and the calls will all be from the same thread. The next call to \doxylink{structcamera3__device__ops_aa6042887b882a06590f477025cc0a894}{process\+\_\+capture\+\_\+request()} will be made as soon as a new request and its associated buffers are available. In a normal preview scenario, this means the function will be called again by the framework almost instantly.

The actual request processing is asynchronous, with the results of capture being returned by the HAL through the process\+\_\+capture\+\_\+result() call. This call requires the result metadata to be available, but output buffers may simply provide sync fences to wait on. Multiple requests are expected to be in flight at once, to maintain full output frame rate.

The framework retains ownership of the request structure. It is only guaranteed to be valid during this call. The HAL device must make copies of the information it needs to retain for the capture processing. The HAL is responsible for waiting on and closing the buffers\textquotesingle{} fences and returning the buffer handles to the framework.

The HAL must write the file descriptor for the input buffer\textquotesingle{}s release sync fence into input\+\_\+buffer-\/\texorpdfstring{$>$}{>}release\+\_\+fence, if input\+\_\+buffer is not NULL. If the HAL returns -\/1 for the input buffer release sync fence, the framework is free to immediately reuse the input buffer. Otherwise, the framework will wait on the sync fence before refilling and reusing the input buffer.

\texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+2\+:

The input/output buffers provided by the framework in each request may be brand new (having never before seen by the HAL).

\DoxyHorRuler{0}
 Performance considerations\+:

Handling a new buffer should be extremely lightweight and there should be no frame rate degradation or frame jitter introduced.

This call must return fast enough to ensure that the requested frame rate can be sustained, especially for streaming cases (post-\/processing quality settings set to FAST). The HAL should return this call in 1 frame interval, and must return from this call in 4 frame intervals.

Return values\+:

0\+: On a successful start to processing the capture request

-\/EINVAL\+: If the input is malformed (the settings are NULL when not allowed, invalid physical camera settings, there are 0 output buffers, etc) and capture processing cannot start. Failures during request processing should be handled by calling \doxylink{structcamera3__callback__ops_a6b866f7b468e677ce586580fab546768}{camera3\+\_\+callback\+\_\+ops\+\_\+t.\+notify()}. In case of this error, the framework will retain responsibility for the stream buffers\textquotesingle{} fences and the buffer handles; the HAL should not close the fences or return these buffers with process\+\_\+capture\+\_\+result.

-\/ENODEV\+: If the camera device has encountered a serious error. After this error is returned, only the close() method can be successfully called by the framework. \Hypertarget{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a}\label{structcamera3__device__ops_a818be692e29ce5e7f142dc9d0424598a} 
\index{camera3\_device\_ops@{camera3\_device\_ops}!register\_stream\_buffers@{register\_stream\_buffers}}
\index{register\_stream\_buffers@{register\_stream\_buffers}!camera3\_device\_ops@{camera3\_device\_ops}}
\doxysubsubsection{\texorpdfstring{register\_stream\_buffers}{register\_stream\_buffers}}
{\footnotesize\ttfamily int(\texorpdfstring{$\ast$}{*} camera3\+\_\+device\+\_\+ops\+::register\+\_\+stream\+\_\+buffers) (const struct \mbox{\hyperlink{structcamera3__device}{camera3\+\_\+device}} \texorpdfstring{$\ast$}{*}, const \mbox{\hyperlink{structcamera3__stream__buffer__set}{camera3\+\_\+stream\+\_\+buffer\+\_\+set\+\_\+t}} \texorpdfstring{$\ast$}{*}buffer\+\_\+set)}

register\+\_\+stream\+\_\+buffers\+:

\texorpdfstring{$>$}{>}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+2\+:

DEPRECATED. This will not be called and must be set to NULL.

\texorpdfstring{$<$}{<}= CAMERA\+\_\+\+DEVICE\+\_\+\+API\+\_\+\+VERSION\+\_\+3\+\_\+1\+:

Register buffers for a given stream with the HAL device. This method is called by the framework after a new stream is defined by configure\+\_\+streams, and before buffers from that stream are included in a capture request. If the same stream is listed in a subsequent \doxylink{structcamera3__device__ops_a45009150abd2287b6bfe4cdae30142bf}{configure\+\_\+streams()} call, register\+\_\+stream\+\_\+buffers will {\itshape not} be called again for that stream.

The framework does not need to register buffers for all configured streams before it submits the first capture request. This allows quick startup for preview (or similar use cases) while other streams are still being allocated.

This method is intended to allow the HAL device to map or otherwise prepare the buffers for later use. The buffers passed in will already be locked for use. At the end of the call, all the buffers must be ready to be returned to the stream. The buffer\+\_\+set argument is only valid for the duration of this call.

If the stream format was set to HAL\+\_\+\+PIXEL\+\_\+\+FORMAT\+\_\+\+IMPLEMENTATION\+\_\+\+DEFINED, the camera HAL should inspect the passed-\/in buffers here to determine any platform-\/private pixel format information.

Performance requirements\+:

This should be a non-\/blocking call. The HAL should return from this call in 1ms, and must return from this call in 5ms.

Return values\+:

0\+: On successful registration of the new stream buffers

-\/EINVAL\+: If the stream\+\_\+buffer\+\_\+set does not refer to a valid active stream, or if the buffers array is invalid.

-\/ENOMEM\+: If there was a failure in registering the buffers. The framework must consider all the stream buffers to be unregistered, and can try to register again later.

-\/ENODEV\+: If there is a fatal error, and the device is no longer operational. Only close() can be called successfully by the framework after this error is returned. 

The documentation for this struct was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
src/peripherals/camera/libcamera/include/android/hardware/libhardware/include/hardware/camera3.\+h\end{DoxyCompactItemize}
