\doxysection{src/peripherals/camera/libcamera/include/libcamera/ipa/ipa\+\_\+interface.h File Reference}
\hypertarget{ipa__interface_8h}{}\label{ipa__interface_8h}\index{src/peripherals/camera/libcamera/include/libcamera/ipa/ipa\_interface.h@{src/peripherals/camera/libcamera/include/libcamera/ipa/ipa\_interface.h}}


\doxylink{classImage}{Image} Processing Algorithm interface.  


\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classlibcamera_1_1IPAInterface}{libcamera\+::\+IPAInterface}}
\begin{DoxyCompactList}\small\item\em C++ Interface for IPA implementation. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacelibcamera}{libcamera}}
\begin{DoxyCompactList}\small\item\em Top-\/level libcamera namespace. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classlibcamera_1_1IPAInterface}{libcamera\+::\+IPAInterface}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{namespacelibcamera_af40a632a4025a789df881469fe54e681}{libcamera\+::ipa\+Create}} ()
\begin{DoxyCompactList}\small\item\em Create an instance of the IPA interface. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\doxylink{classImage}{Image} Processing Algorithm interface. 

Every pipeline handler in libcamera may attach some or all of its cameras to an \doxylink{classImage}{Image} Processing Algorithm (IPA) module. An IPA module is developed for a specific pipeline handler and each pipeline handler may be compatible with multiple IPA implementations, both open and closed source. To support this, libcamera communicates with IPA modules through a per-\/pipeline C++ interface.

IPA modules shall provide an ipa\+Create() function exported as a public C symbol with the following prototype\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{IPAInterface\ *\mbox{\hyperlink{namespacelibcamera_af40a632a4025a789df881469fe54e681}{ipaCreate}}();}

\end{DoxyCode}


The ipa\+Create() function creates an instance of an IPA interface, which models a context of execution for the IPA. IPA modules shall support creating one context per camera, as required by their associated pipeline handler.

The IPA module interface operations are defined in the mojom file corresponding to the pipeline handler, in include/libcamera/ipa/\{pipeline\+\_\+name\}.mojom.

The IPA interface is specific to each pipeline handler. The pipeline handlers define a set of operations used to communicate with their IPA modules. The operations, along with the data structures they use, are collectively referred to as the IPA protocol.

The IPA protocol is defined using the \href{https://chromium.googlesource.com/chromium/src/+/master/mojo/public/tools/bindings/README.md}{\texttt{ Mojo interface definition language}}, in a Mojo module file stored in include/libcamera/ipa/\{pipeline\+\_\+name\}.mojom. The Mojo module contains two Mojo interfaces\+: IPAInterface defines the operations exposed by the IPA and called by the pipeline handler, and IPAEvent\+Interface defines the events generated by the IPA and received by the pipeline handler.

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000032}{Todo}}]Add reference to how pipelines shall document their protocol.\end{DoxyRefDesc}


IPAs can be isolated in a separate process. This implies that arguments to the IPA interface functions may need to be transferred over IPC. An IPA proxy is auto-\/generated based on the mojom file, which abstracts away the (de)serialization from the pipeline handler and the IPA implementation. Thus any C++ structure that is defined in the mojom file, or the C++ libcamera objects that are listed in core.\+mojom, can be used directly.

Due to IPC, synchronous communication between pipeline handlers and IPAs can be costly. For that reason, functions that cannot afford the high cost should be marked as \mbox{[}async\mbox{]} in the mojom file, and they will operate asynchronously. This implies that these functions don\textquotesingle{}t return a status, and that all functions may copy their arguments. Synchronous functions are still allowed, but should be used with caution. 