\doxysection{libcamera\+::ipa\+::ipu3\+::algorithms\+::Af Class Reference}
\hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af}{}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af}\index{libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}}


An auto-\/focus algorithm based on IPU3 statistics.  


Inheritance diagram for libcamera\+::ipa\+::ipu3\+::algorithms\+::Af\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_afcea18b80ab3822bbaa7df4a1f3ca7df}{configure}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const IPAConfig\+Info \&config\+Info) override
\begin{DoxyCompactList}\small\item\em Configure the \doxylink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af}{Af} given a config\+Info. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_a50edbc40bd8238f2d37e826494142dcf}{prepare}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const uint32\+\_\+t frame, \mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&frame\+Context, \mbox{\hyperlink{structipu3__uapi__params}{ipu3\+\_\+uapi\+\_\+params}} \texorpdfstring{$\ast$}{*}params) override
\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_a31e1bf756c1ac08786db1ca5a7c136b7}{process}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const uint32\+\_\+t frame, \mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&frame\+Context, const \mbox{\hyperlink{structipu3__uapi__stats__3a}{ipu3\+\_\+uapi\+\_\+stats\+\_\+3a}} \texorpdfstring{$\ast$}{*}stats, \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&metadata) override
\begin{DoxyCompactList}\small\item\em Determine the max contrast image and lens position. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm}{libcamera\+::ipa\+::\+Algorithm$<$ Module $>$}}}
\begin{DoxyCompactItemize}
\item 
virtual int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a68ad78f4d948f8cebefaaae22b743687}{init}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const \mbox{\hyperlink{classlibcamera_1_1YamlObject}{Yaml\+Object}} \&tuning\+Data)
\begin{DoxyCompactList}\small\item\em Initialize the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} with tuning data. \end{DoxyCompactList}\item 
virtual int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a5e3cd461b46cdd1d366bf211f87d8f3d}{configure}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a7c0b7a42c526c07bafeca4018b38b8c9}{Module\+::\+Config}} \&config\+Info)
\begin{DoxyCompactList}\small\item\em Configure the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} given an IPAConfig\+Info. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a307cf5dd6b48ccc1c772901c07e14afe}{queue\+Request}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, const \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&controls)
\begin{DoxyCompactList}\small\item\em Provide control values to the algorithm. \end{DoxyCompactList}\item 
virtual void {\bfseries prepare} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a48ee62113eed1c9ad7a001887dc59674}{Module\+::\+Params}} \texorpdfstring{$\ast$}{*}params)
\item 
virtual void {\bfseries process} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, const typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_afdcea0695dc0eb1226d66442a5647a41}{Module\+::\+Stats}} \texorpdfstring{$\ast$}{*}stats, \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&metadata)
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Public Types inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm}{libcamera\+::ipa\+::\+Algorithm$<$ Module $>$}}}
\begin{DoxyCompactItemize}
\item 
using {\bfseries Module} = \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_ac52491716c9cd932770dc1a02d7d9b25}{Module}}
\begin{DoxyCompactList}\small\item\em The IPA module type for this class of algorithms. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
An auto-\/focus algorithm based on IPU3 statistics. 

This algorithm is used to determine the position of the lens to make a focused image. The IPU3 AF processing block computes the statistics that are composed by two types of filtered value and stores in a AF buffer. Typically, for a clear image, it has a relatively higher contrast than a blurred one. Therefore, if an image with the highest contrast can be found through the scan, the position of the len indicates to a clearest image. 

\doxysubsection{Member Function Documentation}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_afcea18b80ab3822bbaa7df4a1f3ca7df}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_afcea18b80ab3822bbaa7df4a1f3ca7df} 
\index{libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}!configure@{configure}}
\index{configure@{configure}!libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}}
\doxysubsubsection{\texorpdfstring{configure()}{configure()}}
{\footnotesize\ttfamily int libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Af\+::configure (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const IPAConfig\+Info \&}]{config\+Info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}



Configure the \doxylink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af}{Af} given a config\+Info. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & The shared IPA context \\
\hline
\mbox{\texttt{ in}}  & {\em config\+Info} & The IPA configuration data \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, a negative error code otherwise 
\end{DoxyReturn}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_a50edbc40bd8238f2d37e826494142dcf}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_a50edbc40bd8238f2d37e826494142dcf} 
\index{libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}!prepare@{prepare}}
\index{prepare@{prepare}!libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}}
\doxysubsubsection{\texorpdfstring{prepare()}{prepare()}}
{\footnotesize\ttfamily void libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Af\+::prepare (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const uint32\+\_\+t}]{frame,  }\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&}]{frame\+Context,  }\item[{\mbox{\hyperlink{structipu3__uapi__params}{ipu3\+\_\+uapi\+\_\+params}} \texorpdfstring{$\ast$}{*}}]{params }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}





\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_a31e1bf756c1ac08786db1ca5a7c136b7}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Af_a31e1bf756c1ac08786db1ca5a7c136b7} 
\index{libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}!process@{process}}
\index{process@{process}!libcamera::ipa::ipu3::algorithms::Af@{libcamera::ipa::ipu3::algorithms::Af}}
\doxysubsubsection{\texorpdfstring{process()}{process()}}
{\footnotesize\ttfamily void libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Af\+::process (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const uint32\+\_\+t}]{frame,  }\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&}]{frame\+Context,  }\item[{const \mbox{\hyperlink{structipu3__uapi__stats__3a}{ipu3\+\_\+uapi\+\_\+stats\+\_\+3a}} \texorpdfstring{$\ast$}{*}}]{stats,  }\item[{\mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&}]{metadata }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}



Determine the max contrast image and lens position. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & The IPA context \\
\hline
\mbox{\texttt{ in}}  & {\em frame} & The frame context sequence number \\
\hline
\mbox{\texttt{ in}}  & {\em frame\+Context} & The current frame context \\
\hline
\mbox{\texttt{ in}}  & {\em stats} & The statistics buffer of IPU3 \\
\hline
\mbox{\texttt{ out}}  & {\em metadata} & Metadata for the frame, to be filled by the algorithm\\
\hline
\end{DoxyParams}
Ideally, a clear image also has a relatively higher contrast. So, every image for each focus step should be tested to find an optimal focus step.

The Hill Climbing \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm}\mbox{[}1\mbox{]} is used to find the maximum variance of the AF statistics which is the AF output of IPU3. The focus step is increased then the variance of the AF statistics are estimated. If it finds the negative derivative we have just passed the peak, and we infer that the best focus is found.

\mbox{[}1\mbox{]} Hill Climbing \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm}, \href{https://en.wikipedia.org/wiki/Hill_climbing}{\texttt{ https\+://en.\+wikipedia.\+org/wiki/\+Hill\+\_\+climbing}} 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/peripherals/camera/libcamera/src/ipa/ipu3/algorithms/\mbox{\hyperlink{ipu3_2algorithms_2af_8h}{af.\+h}}\item 
src/peripherals/camera/libcamera/src/ipa/ipu3/algorithms/af.\+cpp\end{DoxyCompactItemize}
