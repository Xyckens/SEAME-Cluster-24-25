\doxysection{libcamera\+::ipa\+::ipu3\+::algorithms\+::Agc Class Reference}
\hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc}{}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc}\index{libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}}


A mean-\/based auto-\/exposure algorithm.  


Inheritance diagram for libcamera\+::ipa\+::ipu3\+::algorithms\+::Agc\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_aae955ad77b9a52e979b8b38b25ae01ef}{init}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const \mbox{\hyperlink{classlibcamera_1_1YamlObject}{Yaml\+Object}} \&tuning\+Data) override
\begin{DoxyCompactList}\small\item\em Initialise the AGC algorithm from tuning files. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_a480e95b5d6e07b2bd8b15e7c448457d1}{configure}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const IPAConfig\+Info \&config\+Info) override
\begin{DoxyCompactList}\small\item\em Configure the AGC given a config\+Info. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_a2559951592bcfd9792bda394a8d4e79b}{process}} (\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&context, const uint32\+\_\+t frame, \mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&frame\+Context, const \mbox{\hyperlink{structipu3__uapi__stats__3a}{ipu3\+\_\+uapi\+\_\+stats\+\_\+3a}} \texorpdfstring{$\ast$}{*}stats, \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&metadata) override
\begin{DoxyCompactList}\small\item\em \doxylink{classlibcamera_1_1Process}{Process} IPU3 statistics, and run AGC operations. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm}{libcamera\+::ipa\+::\+Algorithm$<$ Module $>$}}}
\begin{DoxyCompactItemize}
\item 
virtual int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a68ad78f4d948f8cebefaaae22b743687}{init}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const \mbox{\hyperlink{classlibcamera_1_1YamlObject}{Yaml\+Object}} \&tuning\+Data)
\begin{DoxyCompactList}\small\item\em Initialize the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} with tuning data. \end{DoxyCompactList}\item 
virtual int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a5e3cd461b46cdd1d366bf211f87d8f3d}{configure}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a7c0b7a42c526c07bafeca4018b38b8c9}{Module\+::\+Config}} \&config\+Info)
\begin{DoxyCompactList}\small\item\em Configure the \doxylink{classlibcamera_1_1ipa_1_1Algorithm}{Algorithm} given an IPAConfig\+Info. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_a307cf5dd6b48ccc1c772901c07e14afe}{queue\+Request}} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, const \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&controls)
\begin{DoxyCompactList}\small\item\em Provide control values to the algorithm. \end{DoxyCompactList}\item 
virtual void {\bfseries prepare} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a48ee62113eed1c9ad7a001887dc59674}{Module\+::\+Params}} \texorpdfstring{$\ast$}{*}params)
\item 
virtual void {\bfseries process} (typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a2a12d05faa4f517f4dfcfa087063fd27}{Module\+::\+Context}} \&context, const uint32\+\_\+t frame, typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_a5a1bf7efd7811fb9da8ff311aeef3b1c}{Module\+::\+Frame\+Context}} \&frame\+Context, const typename \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Module_afdcea0695dc0eb1226d66442a5647a41}{Module\+::\+Stats}} \texorpdfstring{$\ast$}{*}stats, \mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&metadata)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1AgcMeanLuminance}{libcamera\+::ipa\+::\+Agc\+Mean\+Luminance}}}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{classlibcamera_1_1ipa_1_1AgcMeanLuminance_aaffc93f92dba52ab302ad086ae4824a5}{parse\+Tuning\+Data}} (const \mbox{\hyperlink{classlibcamera_1_1YamlObject}{Yaml\+Object}} \&tuning\+Data)
\begin{DoxyCompactList}\small\item\em Parse tuning data for Ae\+Constraint\+Mode and Ae\+Exposure\+Mode controls. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1AgcMeanLuminance_a31c6f120a1f4ce2cc82afde8254fbd3d}{set\+Limits}} (\mbox{\hyperlink{classlibcamera_1_1utils_1_1Duration}{utils\+::\+Duration}} min\+Exposure\+Time, \mbox{\hyperlink{classlibcamera_1_1utils_1_1Duration}{utils\+::\+Duration}} max\+Exposure\+Time, double min\+Gain, double max\+Gain)
\begin{DoxyCompactList}\small\item\em Set the \doxylink{classlibcamera_1_1ipa_1_1ExposureModeHelper}{Exposure\+Mode\+Helper} limits for this class. \end{DoxyCompactList}\item 
std\+::map$<$ int32\+\_\+t, std\+::vector$<$ \mbox{\hyperlink{structlibcamera_1_1ipa_1_1AgcMeanLuminance_1_1AgcConstraint}{Agc\+Constraint}} $>$ $>$ {\bfseries constraint\+Modes} ()
\begin{DoxyCompactList}\small\item\em Get the constraint modes that have been parsed from tuning data. \end{DoxyCompactList}\item 
std\+::map$<$ int32\+\_\+t, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classlibcamera_1_1ipa_1_1ExposureModeHelper}{Exposure\+Mode\+Helper}} $>$ $>$ {\bfseries exposure\+Mode\+Helpers} ()
\begin{DoxyCompactList}\small\item\em Get the Exposure\+Mode\+Helpers that have been parsed from tuning data. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classlibcamera_1_1ControlInfoMap_a737e0a528fd58dd5d4f976633322b0fb}{Control\+Info\+Map\+::\+Map}} {\bfseries controls} ()
\begin{DoxyCompactList}\small\item\em Get the controls that have been generated after parsing tuning data. \end{DoxyCompactList}\item 
std\+::tuple$<$ \mbox{\hyperlink{classlibcamera_1_1utils_1_1Duration}{utils\+::\+Duration}}, double, double $>$ \mbox{\hyperlink{classlibcamera_1_1ipa_1_1AgcMeanLuminance_aee6fa02c0b5adb2cf3da8f188e210e39}{calculate\+New\+Ev}} (uint32\+\_\+t constraint\+Mode\+Index, uint32\+\_\+t exposure\+Mode\+Index, const \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Histogram}{Histogram}} \&y\+Hist, \mbox{\hyperlink{classlibcamera_1_1utils_1_1Duration}{utils\+::\+Duration}} effective\+Exposure\+Value)
\begin{DoxyCompactList}\small\item\em Calculate the new exposure value and splut it between exposure time and gain. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classlibcamera_1_1ipa_1_1AgcMeanLuminance_a61f38add75dec3d88aac0f0de9cd00a3}{reset\+Frame\+Count}} ()
\begin{DoxyCompactList}\small\item\em Reset the frame counter. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Public Types inherited from \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm}{libcamera\+::ipa\+::\+Algorithm$<$ Module $>$}}}
\begin{DoxyCompactItemize}
\item 
using {\bfseries Module} = \mbox{\hyperlink{classlibcamera_1_1ipa_1_1Algorithm_ac52491716c9cd932770dc1a02d7d9b25}{Module}}
\begin{DoxyCompactList}\small\item\em The IPA module type for this class of algorithms. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
A mean-\/based auto-\/exposure algorithm. 

This algorithm calculates an exposure time and an analogue gain so that the average value of the green channel of the brightest 2\% of pixels approaches 0.\+5. The AWB gains are not used here, and all cells in the grid have the same weight, like an average-\/metering case. In this metering mode, the camera uses light information from the entire scene and creates an average for the final exposure setting, giving no weighting to any particular portion of the metered area.

Reference\+: Battiato, Messina \& Castorina. (2008). Exposure Correction for Imaging Devices\+: An Overview. 10.\+1201/9781420054538.ch12. 

\doxysubsection{Member Function Documentation}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_a480e95b5d6e07b2bd8b15e7c448457d1}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_a480e95b5d6e07b2bd8b15e7c448457d1} 
\index{libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}!configure@{configure}}
\index{configure@{configure}!libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}}
\doxysubsubsection{\texorpdfstring{configure()}{configure()}}
{\footnotesize\ttfamily int libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Agc\+::configure (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const IPAConfig\+Info \&}]{config\+Info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}



Configure the AGC given a config\+Info. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & The shared IPA context \\
\hline
\mbox{\texttt{ in}}  & {\em config\+Info} & The IPA configuration data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 
\end{DoxyReturn}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_aae955ad77b9a52e979b8b38b25ae01ef}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_aae955ad77b9a52e979b8b38b25ae01ef} 
\index{libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}!init@{init}}
\index{init@{init}!libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily int libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Agc\+::init (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const \mbox{\hyperlink{classlibcamera_1_1YamlObject}{Yaml\+Object}} \&}]{tuning\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}



Initialise the AGC algorithm from tuning files. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & The shared IPA context \\
\hline
\mbox{\texttt{ in}}  & {\em tuning\+Data} & The \doxylink{classlibcamera_1_1YamlObject}{Yaml\+Object} containing \doxylink{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc}{Agc} tuning data\\
\hline
\end{DoxyParams}
This function calls the base class\textquotesingle{} tuning\+Data parsers to discover which control values are supported.

\begin{DoxyReturn}{Returns}
0 on success or errors from the base class 
\end{DoxyReturn}
\Hypertarget{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_a2559951592bcfd9792bda394a8d4e79b}\label{classlibcamera_1_1ipa_1_1ipu3_1_1algorithms_1_1Agc_a2559951592bcfd9792bda394a8d4e79b} 
\index{libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}!process@{process}}
\index{process@{process}!libcamera::ipa::ipu3::algorithms::Agc@{libcamera::ipa::ipu3::algorithms::Agc}}
\doxysubsubsection{\texorpdfstring{process()}{process()}}
{\footnotesize\ttfamily void libcamera\+::ipa\+::ipu3\+::algorithms\+::\+Agc\+::process (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAContext}{IPAContext}} \&}]{context,  }\item[{const uint32\+\_\+t}]{frame,  }\item[{\mbox{\hyperlink{structlibcamera_1_1ipa_1_1ipu3_1_1IPAFrameContext}{IPAFrame\+Context}} \&}]{frame\+Context,  }\item[{const \mbox{\hyperlink{structipu3__uapi__stats__3a}{ipu3\+\_\+uapi\+\_\+stats\+\_\+3a}} \texorpdfstring{$\ast$}{*}}]{stats,  }\item[{\mbox{\hyperlink{classlibcamera_1_1ControlList}{Control\+List}} \&}]{metadata }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}



\doxylink{classlibcamera_1_1Process}{Process} IPU3 statistics, and run AGC operations. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & The shared IPA context \\
\hline
\mbox{\texttt{ in}}  & {\em frame} & The current frame sequence number \\
\hline
\mbox{\texttt{ in}}  & {\em frame\+Context} & The current frame context \\
\hline
\mbox{\texttt{ in}}  & {\em stats} & The IPU3 statistics and ISP results \\
\hline
\mbox{\texttt{ out}}  & {\em metadata} & Metadata for the frame, to be filled by the algorithm\\
\hline
\end{DoxyParams}
Identify the current image brightness, and use that to estimate the optimal new exposure and gain for the scene. 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/peripherals/camera/libcamera/src/ipa/ipu3/algorithms/\mbox{\hyperlink{ipu3_2algorithms_2agc_8h}{agc.\+h}}\item 
src/peripherals/camera/libcamera/src/ipa/ipu3/algorithms/agc.\+cpp\end{DoxyCompactItemize}
